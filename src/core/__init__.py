# Core functionality for self-refinement loop 